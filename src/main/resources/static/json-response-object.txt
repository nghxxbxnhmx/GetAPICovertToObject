@RestController
public class Main {
    public static final String API_URL = "http://systemradiusapi.fpt.vn/api/Mo/GetContractInfoByMac";
    public static final MediaType JSON = MediaType.parse("application/json; charset=utf-8");
    Gson gson = new Gson();

    // đọc response từ api, trả về đối tượng
    @GetMapping("/hehe")
    public String post_request() throws IOException {
        Gson gson = new Gson();
        
        ResponseObject responseObject = new ResponseObject();
        List<Contract> contracts = new ArrayList<>();

        RequestBody formBody = new FormBody.Builder()
                .add("MacAddress", "a4:81:7a:b1:05:92")
                .build();

        Request request = new Request.Builder()
                .url(API_URL)
                .header("Content-Type", "application/json")
                .post(formBody)
                .build();

        try (Response response = new OkHttpClient().newCall(request).execute()) {
            if (!response.isSuccessful()) {
                throw new IOException("Unexpected code: " + response);
            }
            String responseJsonString = response.body().string();
            responseObject = gson.fromJson(responseJsonString, ResponseObject.class);
            contracts = responseObject.getData();

            return contracts.get(1).toString();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }

    // đọc file json trả về đối tượng
    @GetMapping("/huhu")
    public ResponseEntity<Integer> jsonToObject() throws FileNotFoundException {
        String path = "C:\\Java Workspace\\FTEL PROJECT\\ok_http\\src\\main\\resources\\static\\GetContractInfoByMac.json";

        ResponseObject responseObject = new ResponseObject();
        List<Contract> contracts = new ArrayList<>();
        try (BufferedReader bufferedReader = new BufferedReader(new FileReader(path))) {
            Gson gson = new Gson();
            responseObject = gson.fromJson(bufferedReader, ResponseObject.class);
            contracts = responseObject.getData();

            responseObject.toString();
            System.out.println("- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - ");
            contracts.toString();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return ResponseEntity.ok(contracts.get(1).getObjID());
    }

    // đọc file json trả về response
    @GetMapping("/GetContractInfoByMac")
    public ResponseEntity<String> returnJsonString() throws FileNotFoundException {
        String path = "C:\\Java Workspace\\FTEL PROJECT\\ok_http\\src\\main\\resources\\static\\GetContractInfoByMac.json";
        try (BufferedReader bufferedReader = new BufferedReader(new FileReader(path))) {
            StringBuilder stringBuilder = new StringBuilder();
            String line;
            while ((line = bufferedReader.readLine()) != null) {
                stringBuilder.append(line);
            }
            String jsonString = stringBuilder.toString();
            Gson gson = new Gson();
            return ResponseEntity.ok(jsonString);
        } catch (IOException e) {
            e.printStackTrace();
            return ResponseEntity.status(500).body("Internal Server Error");
        }
    }

}
